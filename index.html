<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊàëÁöÑ‰∏™‰∫∫ÂØºËà™</title>
    <link rel="icon" href="logo.ico" type="image/x-icon">
    
    <style>
        :root {
            --work-color: #0f59c1; --social-color: #bc2c1c;
            --entertainment-color: #791da1; --learning-color: #149449;
            --background-color: #eef2f7; --card-color: #ffffff;
            --text-color: #222222; --shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: system-ui, sans-serif; }
        body { background: var(--background-color); color: var(--text-color); line-height: 1.4; padding: 15px; min-height: 100vh; font-size: 13px; }
        .container { max-width: 1000px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 20px; position: relative; }
        h1 { color: #2c3e50; margin-bottom: 15px; font-size: 1.8rem; }
        
        .search-container { max-width: 560px; margin: 0 auto 20px; width: 90%; }
        .search-box { position: relative; width: 100%; }
        .search-box input { width: 100%; padding: 10px 40px 10px 15px; border: 1px solid #ddd; border-radius: 20px; font-size: 13px; box-shadow: var(--shadow); }
        .search-box button { position: absolute; right: 5px; top: 50%; transform: translateY(-50%); background: none; border: none; width: 30px; height: 30px; cursor: pointer; }
        
        .categories-tabs { display: flex; justify-content: center; margin-bottom: 15px; border-bottom: 1px solid #ddd; }
        .category-tab { padding: 8px 20px; cursor: pointer; font-size: 14px; border-bottom: 2px solid transparent; color: #666; }
        .category-tab.active { font-weight: bold; border-bottom-color: #2c5aa0; color: #2c5aa0; }
        
        .category-content { display: none; border-radius: 10px; padding: 15px; box-shadow: var(--shadow); min-height: 300px; background: transparent; }
        .category-content.active { display: block; }
        
        .websites-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 12px; }
        .website-card { background: white; border-radius: 8px; padding: 10px 5px; text-align: center; cursor: pointer; box-shadow: var(--shadow); transition: transform 0.2s, box-shadow 0.2s; position: relative; }
        .website-card:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15); }
        .website-link { display: block; text-decoration: none; color: inherit; }
        .website-icon { width: 40px; height: 40px; margin: 0 auto 5px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .website-name { font-weight: bold; font-size: 11px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        
        .loading { text-align: center; padding: 40px; color: #666; }
        .control-panel { position: absolute; top: 0; right: 0; display: flex; flex-direction: column; gap: 5px; align-items: flex-end; font-size: 11px; }
        .sync-status { font-size: 11px; color: #666; }
        .reset-data-btn { background: none; color: #666; border: none; cursor: pointer; font-size: 11px; }
        .reset-data-btn:hover { color: #333; }
        
        .category-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; }
        .category-title { font-size: 16px; font-weight: bold; }
        .category-actions { display: flex; gap: 8px; }
        .action-btn { background: none; border: none; cursor: pointer; font-size: 12px; padding: 4px 8px; border-radius: 4px; transition: background-color 0.3s; }
        .action-btn:hover { background-color: rgba(0, 0, 0, 0.05); }
        
        .edit-controls { position: absolute; top: 2px; right: 2px; display: none; gap: 2px; }
        .delete-btn, .edit-btn { background: none; border: none; border-radius: 3px; width: 20px; height: 20px; font-size: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .delete-btn { color: #e74c3c; }
        .edit-btn { color: #3498db; }
        
        .website-card.dragging { opacity: 0.4; transform: scale(0.95); }
        .website-card.dragover { border: 2px dashed #2c5aa0; background-color: rgba(44, 90, 160, 0.05); }
        .edit-mode .website-card { cursor: move; }
        
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 2000; align-items: center; justify-content: center; }
        .modal-content { background-color: white; padding: 20px; border-radius: 8px; width: 90%; max-width: 450px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); }
        .modal h3 { margin-bottom: 15px; font-size: 16px; text-align: center; }
        .form-row { display: flex; align-items: center; margin-bottom: 12px; gap: 10px; }
        .form-row label { width: 80px; font-weight: bold; font-size: 12px; }
        .form-row input, .form-row select { flex: 1; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; }
        .form-actions { display: flex; justify-content: flex-end; gap: 8px; margin-top: 15px; }
        .btn { padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; }
        .btn-primary { background: #2c5aa0; color: white; }
        .btn-secondary { background: #ddd; color: #333; }
        
        .decoration-left, .decoration-right { position: fixed; top: auto; bottom: calc(100% - 170px); z-index: 1; opacity: 0.8; pointer-events: none; width: min(150px, 15vw); height: auto; max-width: 20vw; min-width: 60px; }
        .decoration-left { left: max(2%, 5px); }
        .decoration-right { right: max(2%, 5px); }
        
        .category-header[data-category="work"] { border-bottom: 1px solid var(--work-color); }
        .category-header[data-category="social"] { border-bottom: 1px solid var(--social-color); }
        .category-header[data-category="entertainment"] { border-bottom: 1px solid var(--entertainment-color); }
        .category-header[data-category="learning"] { border-bottom: 1px solid var(--learning-color); }
        
        .category-title[data-category="work"] { color: var(--work-color); }
        .category-title[data-category="social"] { color: var(--social-color); }
        .category-title[data-category="entertainment"] { color: var(--entertainment-color); }
        .category-title[data-category="learning"] { color: var(--learning-color); }
        
        .action-btn[data-category="work"] { color: var(--work-color); }
        .action-btn[data-category="social"] { color: var(--social-color); }
        .action-btn[data-category="entertainment"] { color: var(--entertainment-color); }
        .action-btn[data-category="learning"] { color: var(--learning-color); }
        
        .website-icon[data-category="work"] { color: var(--work-color); }
        .website-icon[data-category="social"] { color: var(--social-color); }
        .website-icon[data-category="entertainment"] { color: var(--entertainment-color); }
        .website-icon[data-category="learning"] { color: var(--learning-color); }
        
        @media (max-width: 768px) {
            .websites-grid { grid-template-columns: repeat(auto-fill, minmax(70px, 1fr)); gap: 10px; }
            .website-icon { width: 35px; height: 35px; font-size: 16px; }
        }
        .category-content#work-content { background: #f0f7ff; }
        .category-content#social-content { background: #fff0f0; }
        .category-content#entertainment-content { background: #f8f0ff; }
        .category-content#learning-content { background: #f0fff4; }
        
        .fa-laptop:before { content: "üñ•Ô∏è" }
        .fa-comment:before { content: "üõ†Ô∏è" }
        .fa-film:before { content: "üçú" }
        .fa-seedling:before { content: "üå±" }
        .fa-search:before { content: "üîç" }
    </style>
</head>
<body>
    <img src="left.png" alt="Â∑¶‰æßË£ÖÈ•∞" class="decoration-left" loading="lazy">
    <img src="right.png" alt="Âè≥‰æßË£ÖÈ•∞" class="decoration-right" loading="lazy">
    
    <div class="container">
        <header>
            <div class="control-panel">
                <div class="sync-status" id="syncStatus">Â∑≤ÂêåÊ≠•</div>
                <button class="reset-data-btn" id="resetDataBtn" title="ÂàùÂßãÂåñÊï∞ÊçÆ">ÂàùÂßãÂåñ</button>
            </div>
            <h1>ÊàëÁöÑ‰∏™‰∫∫ÂØºËà™</h1>
            <div class="search-container">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="ËæìÂÖ•ÂÖ≥ÈîÆËØçËøõË°åÂÖ®ÁΩëÊêúÁ¥¢..." aria-label="ÊêúÁ¥¢ËæìÂÖ•Ê°Ü">
                    <button id="searchButton" title="ÊêúÁ¥¢" aria-label="ÊêúÁ¥¢"><i class="fa-search"></i></button>
                </div>
            </div>
        </header>
        
        <div class="categories-tabs">
            <div class="category-tab active" data-category="work" role="tab" aria-selected="true">Â∑•‰Ωú</div>
            <div class="category-tab" data-category="social" role="tab" aria-selected="false">Â∑•ÂÖ∑</div>
            <div class="category-tab" data-category="entertainment" role="tab" aria-selected="false">ÁîüÊ¥ª</div>
            <div class="category-tab" data-category="learning" role="tab" aria-selected="false">Â≠¶‰π†</div>
        </div>
        
        <div class="category-content active" id="work-content">
            <div class="category-header" data-category="work">
                <h2 class="category-title" data-category="work">Â∑•‰Ωú</h2>
                <div class="category-actions">
                    <button class="action-btn edit-mode-toggle" data-category="work" title="ËøõÂÖ•ÁºñËæëÊ®°Âºè" aria-pressed="false">ÁºñËæë</button>
                    <button class="action-btn add-website-btn" data-category="work" title="Ê∑ªÂä†Êñ∞ÁΩëÁ´ô" aria-label="Ê∑ªÂä†Êñ∞ÁΩëÁ´ô">Ê∑ªÂä†</button>
                </div>
            </div>
            <div class="websites-grid" id="work-grid" role="grid" aria-label="Â∑•‰ΩúÁΩëÁ´ôÁΩëÊ†º"><div class="loading">Âä†ËΩΩ‰∏≠...</div></div>
        </div>
        
        <div class="category-content" id="social-content">
            <div class="category-header" data-category="social">
                <h2 class="category-title" data-category="social">Â∑•ÂÖ∑</h2>
                <div class="category-actions">
                    <button class="action-btn edit-mode-toggle" data-category="social" title="ËøõÂÖ•ÁºñËæëÊ®°Âºè" aria-pressed="false">ÁºñËæë</button>
                    <button class="action-btn add-website-btn" data-category="social" title="Ê∑ªÂä†Êñ∞ÁΩëÁ´ô" aria-label="Ê∑ªÂä†Êñ∞ÁΩëÁ´ô">Ê∑ªÂä†</button>
                </div>
            </div>
            <div class="websites-grid" id="social-grid" role="grid" aria-label="Â∑•ÂÖ∑ÁΩëÁ´ôÁΩëÊ†º"><div class="loading">Âä†ËΩΩ‰∏≠...</div></div>
        </div>
        
        <div class="category-content" id="entertainment-content">
            <div class="category-header" data-category="entertainment">
                <h2 class="category-title" data-category="entertainment">ÁîüÊ¥ª</h2>
                <div class="category-actions">
                    <button class="action-btn edit-mode-toggle" data-category="entertainment" title="ËøõÂÖ•ÁºñËæëÊ®°Âºè" aria-pressed="false">ÁºñËæë</button>
                    <button class="action-btn add-website-btn" data-category="entertainment" title="Ê∑ªÂä†Êñ∞ÁΩëÁ´ô" aria-label="Ê∑ªÂä†Êñ∞ÁΩëÁ´ô">Ê∑ªÂä†</button>
                </div>
            </div>
            <div class="websites-grid" id="entertainment-grid" role="grid" aria-label="ÁîüÊ¥ªÁΩëÁ´ôÁΩëÊ†º"><div class="loading">Âä†ËΩΩ‰∏≠...</div></div>
        </div>
        
        <div class="category-content" id="learning-content">
            <div class="category-header" data-category="learning">
                <h2 class="category-title" data-category="learning">Â≠¶‰π†</h2>
                <div class="category-actions">
                    <button class="action-btn edit-mode-toggle" data-category="learning" title="ËøõÂÖ•ÁºñËæëÊ®°Âºè" aria-pressed="false">ÁºñËæë</button>
                    <button class="action-btn add-website-btn" data-category="learning" title="Ê∑ªÂä†Êñ∞ÁΩëÁ´ô" aria-label="Ê∑ªÂä†Êñ∞ÁΩëÁ´ô">Ê∑ªÂä†</button>
                </div>
            </div>
            <div class="websites-grid" id="learning-grid" role="grid" aria-label="Â≠¶‰π†ÁΩëÁ´ôÁΩëÊ†º"><div class="loading">Âä†ËΩΩ‰∏≠...</div></div>
        </div>
    </div>

    <div class="modal" id="addWebsiteModal" aria-hidden="true" role="dialog">
        <div class="modal-content">
            <h3>Ê∑ªÂä†Êñ∞ÁΩëÁ´ô</h3>
            <form id="addWebsiteForm">
                <div class="form-row"><label for="websiteName">ÁΩëÁ´ôÂêçÁß∞</label><input type="text" id="websiteName" required></div>
                <div class="form-row"><label for="websiteUrl">ÁΩëÁ´ôURL</label><input type="url" id="websiteUrl" required></div>
                <div class="form-row"><label for="websiteCategory">ÂàÜÁ±ª</label>
                    <select id="websiteCategory" required>
                        <option value="work">Â∑•‰Ωú</option><option value="social">Â∑•ÂÖ∑</option>
                        <option value="entertainment">ÁîüÊ¥ª</option><option value="learning">Â≠¶‰π†</option>
                    </select>
                </div>
                <div class="form-row"><label for="websiteIcon">ÁΩëÁ´ôÂõæÊ†á</label>
                    <select id="websiteIcon" required>
                        <option value="fa-laptop">Â∑•‰Ωú</option><option value="fa-comment">Â∑•ÂÖ∑</option>
                        <option value="fa-film">ÁîüÊ¥ª</option><option value="fa-seedling">Â≠¶‰π†</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelBtn">ÂèñÊ∂à</button>
                    <button type="submit" class="btn btn-primary">Ê∑ªÂä†</button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal" id="editWebsiteModal" aria-hidden="true" role="dialog">
        <div class="modal-content">
            <h3>ÁºñËæëÁΩëÁ´ô</h3>
            <form id="editWebsiteForm">
                <input type="hidden" id="editWebsiteId">
                <div class="form-row"><label for="editWebsiteName">ÁΩëÁ´ôÂêçÁß∞</label><input type="text" id="editWebsiteName" required></div>
                <div class="form-row"><label for="editWebsiteUrl">ÁΩëÁ´ôURL</label><input type="url" id="editWebsiteUrl" required></div>
                <div class="form-row"><label for="editWebsiteCategory">ÂàÜÁ±ª</label>
                    <select id="editWebsiteCategory" required>
                        <option value="work">Â∑•‰Ωú</option><option value="social">Â∑•ÂÖ∑</option>
                        <option value="entertainment">ÁîüÊ¥ª</option><option value="learning">Â≠¶‰π†</option>
                    </select>
                </div>
                <div class="form-row"><label for="editWebsiteIcon">ÁΩëÁ´ôÂõæÊ†á</label>
                    <select id="editWebsiteIcon" required>
                        <option value="fa-laptop">Â∑•‰Ωú</option><option value="fa-comment">Â∑•ÂÖ∑</option>
                        <option value="fa-film">ÁîüÊ¥ª</option><option value="fa-seedling">Â≠¶‰π†</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelEditBtn">ÂèñÊ∂à</button>
                    <button type="submit" class="btn btn-primary">‰øùÂ≠ò</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const utils = {
            showAlert(message, type = 'info') {
                const alert = document.createElement('div');
                const bgColor = type === 'error' ? '#e74c3c' : type === 'success' ? '#27ae60' : '#333';
                alert.textContent = message;
                alert.style.cssText = `position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: ${bgColor}; color: white; padding: 12px 24px; border-radius: 6px; z-index: 10000; font-size: 14px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); max-width: 80%; text-align: center;`;
                document.body.appendChild(alert);
                setTimeout(() => alert.remove(), 3000);
            },
            
            safeStorage: {
                set(key, data) {
                    try { localStorage.setItem(key, JSON.stringify(data)); return true; } 
                    catch (error) { utils.showAlert('‰øùÂ≠òÊï∞ÊçÆÂ§±Ë¥•', 'error'); return false; }
                },
                get(key, defaultValue = null) {
                    try { const item = localStorage.getItem(key); return item ? JSON.parse(item) : defaultValue; } 
                    catch (error) { utils.showAlert('ËØªÂèñÊï∞ÊçÆÂ§±Ë¥•', 'error'); return defaultValue; }
                }
            },
            
            debounce(func, wait) {
                let timeout; return function executedFunction(...args) {
                    clearTimeout(timeout); timeout = setTimeout(() => func(...args), wait);
                };
            }
        };

        const validator = {
            isValidUrl(url) { try { return new URL(url).protocol === 'http:' || new URL(url).protocol === 'https:'; } catch { return false; } },
            isValidName(name) { return name && name.trim().length > 0 && name.trim().length <= 20; },
            isDuplicateWebsite(websites, newWebsite, excludeId = null) {
                return websites.some(website => website.id !== excludeId && 
                    (website.name.toLowerCase() === newWebsite.name.toLowerCase() || website.url === newWebsite.url));
            },
            validateWebsite(website, websites, isEdit = false) {
                const errors = [];
                if (!this.isValidName(website.name)) errors.push('ÁΩëÁ´ôÂêçÁß∞‰∏çËÉΩ‰∏∫Á©∫‰∏îÈïøÂ∫¶‰∏çËÉΩË∂ÖËøá20‰∏™Â≠óÁ¨¶');
                if (!this.isValidUrl(website.url)) errors.push('ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÁΩëÂùÄÔºàhttp:// Êàñ https://Ôºâ');
                if (this.isDuplicateWebsite(websites, website, isEdit ? website.id : null)) errors.push('ÁΩëÁ´ôÂêçÁß∞ÊàñÁΩëÂùÄÂ∑≤Â≠òÂú®');
                return { isValid: errors.length === 0, errors };
            }
        };

        const App = {
            state: {
                websites: [], currentCategory: 'work', nextId: 1, isEditMode: false, dragSrcElement: null
            },
            eventsInitialized: false,
            config: {
                DEFAULT_WEBSITES: [
                    { id: 1, name: "Google", url: "https://www.google.com", category: "work", icon: "fa-laptop" },
                    { id: 2, name: "GitHub", url: "https://github.com", category: "work", icon: "fa-laptop" },
                    { id: 3, name: "ÂæÆ‰ø°", url: "https://wx.qq.com", category: "social", icon: "fa-comment" },
                    { id: 4, name: "Áü•‰πé", url: "https://www.zhihu.com", category: "social", icon: "fa-comment" },
                    { id: 5, name: "YouTube", url: "https://www.youtube.com", category: "entertainment", icon: "fa-film" },
                    { id: 6, name: "Bilibili", url: "https://www.bilibili.com", category: "entertainment", icon: "fa-film" },
                    { id: 7, name: "Coursera", url: "https://www.coursera.org", category: "learning", icon: "fa-seedling" },
                    { id: 8, name: "MDN Web", url: "https://developer.mozilla.org", category: "learning", icon: "fa-seedling" }
                ]
            },
            
            async loadWebsites() {
                const saved = utils.safeStorage.get('myNavigationWebsites');
                if (saved?.length > 0) {
                    this.state.websites = saved;
                    this.state.nextId = Math.max(...saved.map(w => w.id)) + 1;
                } else {
                    this.state.websites = [...this.config.DEFAULT_WEBSITES];
                    this.state.nextId = Math.max(...this.config.DEFAULT_WEBSITES.map(w => w.id)) + 1;
                    this.saveWebsites();
                }
            },
            
            saveWebsites() { return utils.safeStorage.set('myNavigationWebsites', this.state.websites); },
            
            addWebsite(websiteData) {
                const validation = validator.validateWebsite(websiteData, this.state.websites);
                if (!validation.isValid) { validation.errors.forEach(error => utils.showAlert(error, 'error')); return false; }
                
                const newWebsite = {
                    id: this.state.nextId++, name: websiteData.name.trim(),
                    url: websiteData.url.startsWith('http') ? websiteData.url : 'https://' + websiteData.url,
                    category: websiteData.category, icon: websiteData.icon
                };
                this.state.websites.push(newWebsite);
                this.saveWebsites();
                return true;
            },
            
            updateWebsite(websiteId, websiteData) {
                const validation = validator.validateWebsite(websiteData, this.state.websites, true);
                if (!validation.isValid) { validation.errors.forEach(error => utils.showAlert(error, 'error')); return false; }
                
                const website = this.state.websites.find(w => w.id === websiteId);
                if (website) {
                    website.name = websiteData.name.trim();
                    website.url = websiteData.url.startsWith('http') ? websiteData.url : 'https://' + websiteData.url;
                    website.category = websiteData.category;
                    website.icon = websiteData.icon;
                    this.saveWebsites();
                    return true;
                }
                return false;
            },
            
            deleteWebsite(websiteId) {
                this.state.websites = this.state.websites.filter(website => website.id !== websiteId);
                this.saveWebsites();
                return true;
            },
            
            handleDragStart(e) {
                if (!this.state.isEditMode) { e.preventDefault(); return false; }
                this.state.dragSrcElement = e.target.closest('.website-card');
                this.state.dragSrcElement.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/plain', this.state.dragSrcElement.getAttribute('data-id'));
                setTimeout(() => this.state.dragSrcElement.style.opacity = '0.4', 0);
            },
            
            handleDragEnd(e) {
                if (!this.state.isEditMode) return;
                const card = e.target.closest('.website-card');
                card.style.opacity = '1';
                card.classList.remove('dragging');
                document.querySelectorAll('.website-card').forEach(card => card.classList.remove('dragover'));
            },
            
            handleDragOver(e) {
                if (!this.state.isEditMode) return;
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                return false;
            },
            
            handleDragEnter(e) {
                if (!this.state.isEditMode) return;
                e.target.closest('.website-card')?.classList.add('dragover');
            },
            
            handleDragLeave(e) {
                if (!this.state.isEditMode) return;
                const card = e.target.closest('.website-card');
                if (card && !card.contains(e.relatedTarget)) {
                    card.classList.remove('dragover');
                }
            },
            
            handleDrop(e) {
                if (!this.state.isEditMode) return;
                e.preventDefault();
                e.stopPropagation();
                
                const dropCard = e.target.closest('.website-card');
                if (this.state.dragSrcElement && dropCard && this.state.dragSrcElement !== dropCard) {
                    const dragId = parseInt(this.state.dragSrcElement.getAttribute('data-id'));
                    const dropId = parseInt(dropCard.getAttribute('data-id'));
                    const dragIndex = this.state.websites.findIndex(w => w.id === dragId);
                    const dropIndex = this.state.websites.findIndex(w => w.id === dropId);
                    
                    if (dragIndex !== -1 && dropIndex !== -1) {
                        [this.state.websites[dragIndex], this.state.websites[dropIndex]] = 
                        [this.state.websites[dropIndex], this.state.websites[dragIndex]];
                        this.saveWebsites();
                        this.renderWebsites();
                        utils.showAlert('ÁΩëÁ´ôÈ°∫Â∫èÂ∑≤Êõ¥Êñ∞ÔºÅ', 'success');
                    }
                }
                
                dropCard?.classList.remove('dragover');
                return false;
            },
            
            initDragAndDrop() {
                const dragEvents = [
                    ['dragstart', this.handleDragStart.bind(this)],
                    ['dragend', this.handleDragEnd.bind(this)],
                    ['dragover', this.handleDragOver.bind(this)],
                    ['dragenter', this.handleDragEnter.bind(this)],
                    ['dragleave', this.handleDragLeave.bind(this)],
                    ['drop', this.handleDrop.bind(this)]
                ];
                
                document.querySelectorAll('.website-card').forEach(card => {
                    dragEvents.forEach(([event, handler]) => {
                        card.addEventListener(event, handler);
                    });
                });
            },
            
            performSearch(searchTerm) {
                if (!searchTerm.trim()) return;
                const keywords = searchTerm.toLowerCase().split(/\s+/).filter(k => k.length > 0);
                if (keywords.length === 0) return;
                window.open(`https://www.bing.com/search?q=${encodeURIComponent(keywords.join('+'))}`, '_blank');
            },
            
            createWebsiteCard(website) {
                const card = document.createElement('div');
                card.className = 'website-card';
                card.setAttribute('data-id', website.id);
                card.setAttribute('draggable', this.state.isEditMode ? 'true' : 'false');
                card.innerHTML = `
                    <div class="edit-controls" style="display: ${this.state.isEditMode ? 'flex' : 'none'}">
                        <button class="delete-btn" data-id="${website.id}" title="Âà†Èô§ÁΩëÁ´ô">Âà†</button>
                        <button class="edit-btn" data-id="${website.id}" title="‰øÆÊîπÁΩëÁ´ô">Êîπ</button>
                    </div>
                    <a href="${website.url}" target="_blank" class="website-link">
                        <div class="website-icon" data-category="${website.category}"><i class="${website.icon}"></i></div>
                        <div class="website-name">${website.name}</div>
                    </a>`;
                return card;
            },
            
            renderWebsites() {
                ['work', 'social', 'entertainment', 'learning'].forEach(category => {
                    const grid = document.getElementById(`${category}-grid`);
                    if (grid) {
                        grid.innerHTML = '';
                        this.state.websites.filter(website => website.category === category).forEach(website => {
                            grid.appendChild(this.createWebsiteCard(website));
                        });
                        const loading = grid.querySelector('.loading');
                        if (loading) loading.style.display = 'none';
                    }
                });
                this.initDragAndDrop();
                this.initCardEvents();
            },
            
            initCardEvents() {
                if (this.eventsInitialized) return;
                
                document.addEventListener('click', (e) => {
                    if (e.target.closest('.delete-btn')) {
                        const id = parseInt(e.target.closest('.delete-btn').dataset.id);
                        if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ÁΩëÁ´ôÂêóÔºü') && this.deleteWebsite(id)) {
                            utils.showAlert('ÁΩëÁ´ôÂà†Èô§ÊàêÂäüÔºÅ', 'success');
                            this.renderWebsites();
                        }
                    }
                    
                    if (e.target.closest('.edit-btn')) {
                        const id = parseInt(e.target.closest('.edit-btn').dataset.id);
                        const website = this.state.websites.find(w => w.id === id);
                        if (website) {
                            document.getElementById('editWebsiteId').value = website.id;
                            document.getElementById('editWebsiteName').value = website.name;
                            document.getElementById('editWebsiteUrl').value = website.url;
                            document.getElementById('editWebsiteCategory').value = website.category;
                            document.getElementById('editWebsiteIcon').value = website.icon;
                            this.showModal('editWebsiteModal');
                        }
                    }
                });
                
                this.eventsInitialized = true;
            },
            
            init() {
                this.eventsInitialized = false;
                
                document.querySelectorAll('.category-tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        const category = tab.dataset.category;
                        document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
                        document.querySelectorAll('.category-content').forEach(c => c.classList.remove('active'));
                        tab.classList.add('active');
                        document.getElementById(`${category}-content`).classList.add('active');
                        this.state.currentCategory = category;
                    });
                });
                
                const searchInput = document.getElementById('searchInput');
                const debouncedSearch = utils.debounce(() => this.performSearch(searchInput.value), 300);
                searchInput.addEventListener('input', debouncedSearch);
                document.getElementById('searchButton').addEventListener('click', () => this.performSearch(searchInput.value));
                searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.performSearch(searchInput.value);
                });
                
                document.querySelectorAll('.edit-mode-toggle').forEach(btn => {
                    btn.addEventListener('click', () => {
                        this.state.isEditMode = !this.state.isEditMode;
                        document.querySelectorAll('.edit-controls').forEach(editControl => {
                            editControl.style.display = this.state.isEditMode ? 'flex' : 'none';
                        });
                        document.querySelectorAll('.website-card').forEach(card => {
                            card.setAttribute('draggable', this.state.isEditMode ? 'true' : 'false');
                        });
                        document.querySelectorAll('.edit-mode-toggle').forEach(btn => {
                            btn.textContent = this.state.isEditMode ? 'ÂÆåÊàê' : 'ÁºñËæë';
                        });
                        this.initDragAndDrop();
                    });
                });
                
                document.querySelectorAll('.add-website-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.getElementById('websiteCategory').value = btn.dataset.category;
                        this.showModal('addWebsiteModal');
                    });
                });
                
                document.getElementById('addWebsiteForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const formData = {
                        name: document.getElementById('websiteName').value,
                        url: document.getElementById('websiteUrl').value,
                        category: document.getElementById('websiteCategory').value,
                        icon: document.getElementById('websiteIcon').value
                    };
                    if (this.addWebsite(formData)) {
                        this.hideModal('addWebsiteModal');
                        document.getElementById('addWebsiteForm').reset();
                        utils.showAlert('ÁΩëÁ´ôÊ∑ªÂä†ÊàêÂäüÔºÅ', 'success');
                        this.renderWebsites();
                    }
                });
                
                document.getElementById('editWebsiteForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const formData = {
                        name: document.getElementById('editWebsiteName').value,
                        url: document.getElementById('editWebsiteUrl').value,
                        category: document.getElementById('editWebsiteCategory').value,
                        icon: document.getElementById('editWebsiteIcon').value
                    };
                    const websiteId = parseInt(document.getElementById('editWebsiteId').value);
                    if (this.updateWebsite(websiteId, formData)) {
                        this.hideModal('editWebsiteModal');
                        utils.showAlert('ÁΩëÁ´ô‰øÆÊîπÊàêÂäüÔºÅ', 'success');
                        this.renderWebsites();
                    }
                });
                
                document.getElementById('cancelBtn').addEventListener('click', () => this.hideModal('addWebsiteModal'));
                document.getElementById('cancelEditBtn').addEventListener('click', () => this.hideModal('editWebsiteModal'));
                
                document.getElementById('resetDataBtn').addEventListener('click', () => {
                    if (confirm('Á°ÆÂÆöË¶ÅÈáçÁΩÆÊâÄÊúâÊï∞ÊçÆÂêóÔºü')) {
                        this.state.websites = [...this.config.DEFAULT_WEBSITES];
                        this.state.nextId = Math.max(...this.config.DEFAULT_WEBSITES.map(w => w.id)) + 1;
                        this.saveWebsites();
                        this.renderWebsites();
                        utils.showAlert('Êï∞ÊçÆÈáçÁΩÆÊàêÂäüÔºÅ', 'success');
                    }
                });
                
                window.addEventListener('click', (e) => {
                    if (e.target.classList.contains('modal')) {
                        this.hideModal(e.target.id);
                        e.target.querySelector('form')?.reset();
                    }
                });
                
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        document.querySelectorAll('.modal').forEach(modal => {
                            if (modal.style.display === 'flex') {
                                this.hideModal(modal.id);
                                modal.querySelector('form')?.reset();
                            }
                        });
                    }
                });
            },
            
            showModal(modalId) { document.getElementById(modalId).style.display = 'flex'; },
            hideModal(modalId) { document.getElementById(modalId).style.display = 'none'; }
        };

        document.addEventListener('DOMContentLoaded', async function() {
            await App.loadWebsites();
            App.init();
            App.renderWebsites();
        });
    </script>
</body>
</html>